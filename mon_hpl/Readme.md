# HPL System Stats Monitor

A set of scripts for running High Performance Linpack (HPL) Verson 2.3 and monitoring the system's performance metrics throughout. Designed for and tested on Debian GNU/Linux 12 (bookworm) although it ought to work on most linux distributions.

## Installation

1. Set up High Performance Linkpack on your machine. A good guide to follow is [How to compile HPL LINPACK on Ubuntu 22.04](https://www.mgaillard.fr/2022/08/27/benchmark-with-hpl.html) by Mathieu Gaillard.
2. Install python dependancies

        pip install -r requirements.txt

## Usage

1. Collect raw data using [mon_hpl.py](#mon_hplpy)
2. Process the data using [process_runs.py](#process_runspy)

## mon_hpl.py

Runs HPL and collects RAPL data, thermal zone data, cpu core frequencies data, and perf performance counters

> **NOTE:** In order to collect RAPL data, ```mon_hpl.py``` must be run as root

### Usage

    python3 mon_hpl.py --help

### Output

The monitor script produces a directory tree as shown here:

    out_dir/                   
    |- metadata.json        # overall metadata (n_runs, t_samp, etc)
    |- HPL.dat              # HPL.dat file used for the HPL runs   
    |- run_0_raw/           
    |  |- metadata.json     # HPL run specific metadata (gflops, etc)
    |  |- perf.json         # raw collected performance counter data
    |  |- cpu_data.csv      # raw collected cpu frequency data
    |  |- rapl_data.csv     # raw collected RAPL data
    |  |- thermal_data.csv  # raw collected thermal zone data
    |...
    |- run_N_raw/
    |  |-...


## process_runs.py

Takes the raw data generated by [mon_hpl.py](#mon_hplpy) and processes it by converting the RAPL data to watts, and averaging the runs.
The script works in the case that the number of runs was 1 as well.

### Usage

    python3 process_runs.py --help

### Output

    out_dir/
    |- HPL.dat              # HPL.dat file used for the processed HPL runs 
    |- metadata.json        # metadata about the processed data (primarily used to assist plotting)
    |- perf.json            # averaged performance counter data
    |- cpu_data.csv         # cpu data averaged over n_runs runs
    |- thermal_data.csv     # thermal data averaged over n_runs runs
    |- watts_data.csv       # power usage in watts calculated from the raw 
                                rapl data, averaged over n_runs runs

## Tests

In order to measure the ovehead of mon_hpl.py, a dummy xhpl script is provided in ./overhead_test/. The script simply sleeps for a while, and then echos the results of a dummy HPL run. The script will still collect performance data, but will capture a lot of noise in the process. Therefore it is best to perform a large number of runs and average the results.

    sudo python3 mon_hpl.py overhead_test out_overhead -n 100
    python3 process_runs.py out_overhead out_overhead_p
    python3 plot_results.py out_overhead_p